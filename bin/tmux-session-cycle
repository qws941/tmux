#!/usr/bin/env bash
# tmux-session-cycle â€” cycle through sessions with wrap-around
# Usage: tmux-session-cycle next|prev

direction="${1:-next}"
current=$(tmux display-message -p '#S')

# Build sorted session list
sessions=()
while IFS= read -r name; do
  sessions+=("$name")
done < <(tmux list-sessions -F '#{session_name}' 2>/dev/null | sort)

(( ${#sessions[@]} == 0 )) && exit 0

# Find current session index
idx=-1
for i in "${!sessions[@]}"; do
  if [[ "${sessions[$i]}" == "$current" ]]; then
    idx=$i
    break
  fi
done

# If not found, jump to first
if (( idx < 0 )); then
  tmux switch-client -t "${sessions[0]}"
  exit 0
fi

# Wrap-around next/prev
count=${#sessions[@]}
if [[ "$direction" == "next" ]]; then
  next_idx=$(( (idx + 1) % count ))
else
  next_idx=$(( (idx - 1 + count) % count ))
fi

tmux switch-client -t "${sessions[$next_idx]}"
