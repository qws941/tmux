#!/usr/bin/env bash
# tmux-auto-attach — SSH 접속시 자동 세션 연결
# Usage: Add to ~/.bashrc:
#   [[ -n "$SSH_CONNECTION" && -z "$TMUX" ]] && ~/.tmux/bin/tmux-auto-attach

set -euo pipefail

# Already inside tmux? Skip.
[[ -n "${TMUX:-}" ]] && exit 0

# Try attaching to existing session first
if tmux attach 2>/dev/null; then
    exit 0
fi

# No session exists — create 'main' with sidebar
tmux new-session -ds main
~/.tmux/bin/tmux-sidebar-init main 2>/dev/null || true
exec tmux attach -t main
