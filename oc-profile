#!/usr/bin/env bash
set -euo pipefail

# oc-profile — OpenCode oh-my-opencode.json profile switcher
# Usage: copilot | google | gemini  (symlinks to this script)

SELF="$(basename "$0")"
OC_DIR="${OPENCODE_CONFIG_DIR:-$HOME/.config/opencode}"
TARGET="$OC_DIR/oh-my-opencode.json"

# Map script name → profile variant
case "$SELF" in
  copilot) PROFILE="copilot" ;;
  google)  PROFILE="google"  ;;
  gemini)  PROFILE="gemini"  ;;
  *)
    echo "Usage: copilot | google | gemini" >&2
    echo "  copilot → switch to Copilot profile" >&2
    echo "  google → switch to Google profile" >&2
    echo "  gemini → switch to Gemini profile" >&2
    exit 1
    ;;
esac

SOURCE="$OC_DIR/oh-my-opencode.json.$PROFILE"

if [[ ! -f "$SOURCE" ]]; then
  echo "error: profile not found: $SOURCE" >&2
  exit 1
fi

cp "$SOURCE" "$TARGET"
echo "Switched to $PROFILE profile"
